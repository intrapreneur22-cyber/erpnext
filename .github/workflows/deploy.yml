name: Local Deploy ERPNext Bench

on:
  push:
    branches:
      - main

jobs:
  deploy:
    # This is the magic line that tells it to run on YOUR local machine
    runs-on: self-hosted
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy Local Bench
        run: |
          cd /home/frappe/frappe-bench
          
          # 1. Pull the latest code
          git pull origin main
          
          # 2. Update the database
          # We use the full path to bench to ensure it's found
          bench migrate
          
          # 3. Clear cache and restart
          bench clear-cache
          bench restart
